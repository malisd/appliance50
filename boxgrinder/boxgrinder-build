#!/usr/bin/ruby
#
# This file was generated by RubyGems.
#
# The application 'boxgrinder-build' is installed as part of a gem, and
# this file is here to facilitate running it.
#

require 'rubygems'

version = ">= 0"

if ARGV.first =~ /^_(.*)_$/ and Gem::Version.correct? $1 then
  version = $1
  ARGV.shift
end

# plugins/os/fedora/fedora-plugin.rb
print "Monkey-patching plugins/os/fedora/fedora-plugin.rb...\n"
require 'boxgrinder-build/plugins/os/fedora/fedora-plugin.rb'
module BoxGrinder
  class FedoraPlugin < RPMBasedOSPlugin

    # don't override appliance50.ks
    def disable_biosdevname(guestfs)
    end

    # don't override appliance50.ks
    def change_runlevel(guestfs)
    end

    # no need in Fedora 17
    def disable_netfs(guestfs)
    end

    # no need in Fedora 17
    def link_mtab(guestfs)
    end

  end
end

# plugins/os/rpm-based/rpm-based-os-plugin
print "Monkey-patching plugins/os/rpm-based/rpm-based-os-plugin.rb...\n"
require 'boxgrinder-build/plugins/os/rpm-based/rpm-based-os-plugin'
module BoxGrinder
  class RPMBasedOSPlugin < BasePlugin

    # don't override appliance50.ks
    def apply_root_password(guestfs)
    end

    # don't override appliance50.ks
    def change_configuration(guestfs_helper)
    end

    # don't override appliance50.ks
    def disable_firewall(guestfs)
    end

    # don't override appliance50.ks
    def install_repos(guestfs)
    end

    # don't override appliance50.ks
    def set_label_for_swap_partitions(guestfs, guestfs_helper)
    end

    # don't override appliance50.ks
    def set_motd(guestfs)
    end

    # don't override appliance50.ks.erb
    def use_labels_for_partitions(guestfs)
    end

  end
end

# plugins/os/rpm-based/kickstart.rb
print "Monkey-patching plugins/os/rpm-based/kickstart.rb...\n"
require 'boxgrinder-build/plugins/os/rpm-based/kickstart'
module BoxGrinder
  class Kickstart

    def create
      template = "#{File.dirname(__FILE__)}/appliance50.ks.erb"
      kickstart = ERB.new(File.read(template)).result(build_definition.get_binding)
      File.open(@kickstart_file, 'w') { |f| f.write(kickstart) }
      @kickstart_file
    end

  end
end

# plugins/os/rpm-based/rpm-dependency-validator.rb
print 'Monkey-patching plugins/os/rpm-based/rpm-dependency-validator.rb'
require 'boxgrinder-build/plugins/os/rpm-based/rpm-dependency-validator.rb'
module BoxGrinder
  class RPMDependencyValidator
    def invalid_names( repo_list, package_list )
      []
    end
  end
end

gem 'boxgrinder-build', version
load Gem.bin_path('boxgrinder-build', 'boxgrinder-build', version)
